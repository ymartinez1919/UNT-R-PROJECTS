<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Week 4 Assignment: Yvonne Martinez</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Martinez_Yvonne_Lab4_files/libs/clipboard/clipboard.min.js"></script>
<script src="Martinez_Yvonne_Lab4_files/libs/quarto-html/quarto.js"></script>
<script src="Martinez_Yvonne_Lab4_files/libs/quarto-html/popper.min.js"></script>
<script src="Martinez_Yvonne_Lab4_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Martinez_Yvonne_Lab4_files/libs/quarto-html/anchor.min.js"></script>
<link href="Martinez_Yvonne_Lab4_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Martinez_Yvonne_Lab4_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Martinez_Yvonne_Lab4_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Martinez_Yvonne_Lab4_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Martinez_Yvonne_Lab4_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 4 Assignment: Yvonne Martinez</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="business-problem" class="level2">
<h2 class="anchored" data-anchor-id="business-problem">Business Problem</h2>
<p>You work for a consulting company to understand the factors on which professional Baseball players’ salaries depend.</p>
<p>You are given individual data for professional players in the Major League along with their 1986 performance measures and 1987 salary.</p>
<p>The business goal of the consulting firm is to model the logged salary of professional Baseball players with the available independent variables. Your findings will be used by the company clients to understand how exactly the logged salaries vary with the independent variables.</p>
<p>The data consists of 263 observations of 16 attributes. Below is a brief description of the variables in the data:</p>
<p><strong>Attributes:</strong></p>
<ul>
<li><p><strong>CrAtBat</strong> Career Times at Bat</p></li>
<li><p><strong>CrBB</strong> Career Walks</p></li>
<li><p><strong>CrHits</strong> Career Hits</p></li>
<li><p><strong>CrHome</strong> Career Home Runs</p></li>
<li><p><strong>CrRbi</strong> Career RBIs</p></li>
<li><p><strong>CrRuns</strong> Career Runs</p></li>
<li><p><strong>YrMajor</strong> Years in the Major Leagues</p></li>
<li><p><strong>nAssts</strong> Assists in 1986</p></li>
<li><p><strong>nAtBat</strong> Times at Bat in 1986</p></li>
<li><p><strong>nBB</strong> Walks in 1986</p></li>
<li><p><strong>nError</strong> Errors in 1986</p></li>
<li><p><strong>nHits</strong> Hits in 1986</p></li>
<li><p><strong>nHome</strong> Home Runs in 1986</p></li>
<li><p><strong>nOuts</strong> Put Outs in 1986</p></li>
<li><p><strong>nRBI</strong> RBIs in 1986</p></li>
<li><p><strong>nRuns</strong> Runs in 1986</p></li>
</ul>
<p><strong>Outcome:</strong></p>
<p><strong>LogSalary</strong>: Log of 1987 Salary in $ Thousands</p>
<p>Below, the dataset is loaded and then split into a train and test sets in a 80:20 ratio. Your job is to use the training set to build the models in Parts 1-3. In Part 4, you will use the test set to check the model performance.</p>
<section id="do-not-change-anything-in-this-r-chunk.-just-run-the-code-chunk-and-move-to-the-next-one" class="level4">
<h4 class="anchored" data-anchor-id="do-not-change-anything-in-this-r-chunk.-just-run-the-code-chunk-and-move-to-the-next-one">Do not change anything in this r chunk. Just run the code chunk and move to the next one</h4>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded glmnet 4.1-7</code></pre>
</div>
</div>
</section>
<section id="part-1-full-model-on-all-regressors" class="level3">
<h3 class="anchored" data-anchor-id="part-1-full-model-on-all-regressors">Part 1: Full Model on All Regressors</h3>
<p>You will only use <strong>trainData</strong> in <strong>Part 1.</strong></p>
<p>By using the <strong>trainData</strong>, fit a standard linear regression with the variable <strong>logSalary</strong> as the response and all other attributes as predictors. Name it as <strong>model_full</strong>.</p>
</section>
</section>
<section id="question-1" class="level2">
<h2 class="anchored" data-anchor-id="question-1">Question #1</h2>
<p>According to the <strong>model_full</strong> results, which regression coefficients are statistically significant at the 99% confidence level? Select all that apply.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#fit a standard linear regression with the variable logSalary as the response and all other attributes as predictors. Name it as model_full</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model_full <span class="ot">&lt;-</span> <span class="fu">lm</span>(logSalary <span class="sc">~</span> ., <span class="at">data =</span> trainData)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = logSalary ~ ., data = trainData)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.23518 -0.38604  0.05403  0.41878  1.26539 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  4.2375266  0.1761098  24.062  &lt; 2e-16 ***
nAtBat      -0.0020377  0.0012827  -1.589 0.113778    
nHits        0.0123668  0.0047572   2.600 0.010051 *  
nHome        0.0075024  0.0117295   0.640 0.523177    
nRuns       -0.0037564  0.0059536  -0.631 0.528818    
nRBI        -0.0006802  0.0050769  -0.134 0.893558    
nBB          0.0123192  0.0035077   3.512 0.000553 ***
YrMajor      0.0808472  0.0235407   3.434 0.000726 ***
CrAtBat      0.0001220  0.0002560   0.477 0.634204    
CrHits      -0.0006232  0.0013110  -0.475 0.635080    
CrHome      -0.0005427  0.0030564  -0.178 0.859254    
CrRuns       0.0014737  0.0014468   1.019 0.309637    
CrRbi        0.0003649  0.0013122   0.278 0.781236    
CrBB        -0.0015703  0.0006199  -2.533 0.012100 *  
nOuts        0.0004799  0.0001641   2.924 0.003863 ** 
nAssts       0.0001767  0.0004413   0.400 0.689301    
nError      -0.0020375  0.0091949  -0.222 0.824867    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.5602 on 194 degrees of freedom
Multiple R-squared:  0.6193,    Adjusted R-squared:  0.5879 
F-statistic: 19.72 on 16 and 194 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the regression results</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_full)<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Estimate   Std. Error    t value     Pr(&gt;|t|)
(Intercept)  4.2375266336 0.1761098353 24.0618397 3.840334e-60
nAtBat      -0.0020376716 0.0012826800 -1.5886048 1.137780e-01
nHits        0.0123668353 0.0047572285  2.5995882 1.005137e-02
nHome        0.0075023660 0.0117294886  0.6396158 5.231770e-01
nRuns       -0.0037564081 0.0059536028 -0.6309471 5.288178e-01
nRBI        -0.0006802062 0.0050769358 -0.1339797 8.935575e-01
nBB          0.0123192076 0.0035076666  3.5120806 5.530162e-04
YrMajor      0.0808472281 0.0235407122  3.4343578 7.262501e-04
CrAtBat      0.0001219822 0.0002559580  0.4765714 6.342037e-01
CrHits      -0.0006231532 0.0013109652 -0.4753392 6.350800e-01
CrHome      -0.0005426989 0.0030564221 -0.1775602 8.592537e-01
CrRuns       0.0014737384 0.0014467526  1.0186527 3.096365e-01
CrRbi        0.0003649257 0.0013122380  0.2780942 7.812362e-01
CrBB        -0.0015703150 0.0006199406 -2.5330089 1.210030e-02
nOuts        0.0004799025 0.0001641079  2.9243105 3.863220e-03
nAssts       0.0001766795 0.0004412550  0.4004023 6.893008e-01
nError      -0.0020374804 0.0091948797 -0.2215886 8.248672e-01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Get the  p values</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_full)<span class="sc">$</span>coefficients[,<span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept)       nAtBat        nHits        nHome        nRuns         nRBI 
3.840334e-60 1.137780e-01 1.005137e-02 5.231770e-01 5.288178e-01 8.935575e-01 
         nBB      YrMajor      CrAtBat       CrHits       CrHome       CrRuns 
5.530162e-04 7.262501e-04 6.342037e-01 6.350800e-01 8.592537e-01 3.096365e-01 
       CrRbi         CrBB        nOuts       nAssts       nError 
7.812362e-01 1.210030e-02 3.863220e-03 6.893008e-01 8.248672e-01 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the coefficients with p values less than 0.01</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">which</span>(<span class="fu">summary</span>(model_full)<span class="sc">$</span>coefficients[,<span class="dv">4</span>]<span class="sc">&lt;</span>.<span class="dv">01</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "(Intercept)" "nBB"         "YrMajor"     "nOuts"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">coef=</span><span class="fu">names</span>(<span class="fu">which</span>(<span class="fu">summary</span>(model_full)<span class="sc">$</span>coefficients[,<span class="dv">4</span>]<span class="sc">&lt;</span>.<span class="dv">01</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         coef
1 (Intercept)
2         nBB
3     YrMajor
4       nOuts</code></pre>
</div>
</div>
</section>
<section id="question-2" class="level1">
<h1>Question 2</h1>
<p>Calculate the mean-squared prediction error (MSPE), the adjusted <span class="math inline">\(R^2\)</span> , AIC, and BIC criterion values for <strong>model_full.</strong> Enter your selection in Canvas by selecting the closest answer choice from the list.&nbsp;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Insert your R code for Question 2 in here</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># HINTS: </span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># You can whether manually calculate or use a package to calculate MSPE</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjusted R Square is stored under model_full R object</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># You can consider using AIC() function in stats package to calculate the AIC value</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># You can consider using BIC() function in stats package to calculate the BIC value</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># If you want to print all your answers in one dataframe you can just put it in a dataframe with   data.frame(MSPE=,  ADJR2=, AIC=, BIC=) or just print them separately </span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># mean-squared prediction error (MSPE)</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>MSPE_fullmodel<span class="ot">=</span><span class="fu">mean</span>(model_full<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>MSPE_fullmodel</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2885564</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjusted R-squared</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>RSquared_Adj_fullmodel<span class="ot">&lt;-</span><span class="fu">summary</span>(model_full)<span class="sc">$</span>adj.r.squared</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>RSquared_Adj_fullmodel</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5878716</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AIC</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>AIC<span class="ot">&lt;-</span><span class="fu">AIC</span>(model_full)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>AIC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 372.5476</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># BIC</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>BIC<span class="ot">&lt;-</span><span class="fu">BIC</span>(model_full)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>BIC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 432.8811</code></pre>
</div>
</div>
</section>
<section id="section" class="level1">
<h1></h1>
</section>
<section id="question-3" class="level1">
<h1>Question 3</h1>
<p>So far, we did not do any feature selection. Instead, we have calculated the Adjusted R-squared, AIC, and BIC criterion values for the full model with all features are included as predictor in our largest model. In the following parts, we will choose the best sub-model based on one of these criterion values.</p>
<p>Now, your task is to predict <strong>logSalary</strong> with all the predictors in <strong>trainData,</strong> then calculate the mean squared prediction errors (MSPE) in the <strong>trainData</strong> based on 5-fold, 10-fold and leave one out cross-validation approaches?</p>
<p>Use <strong>cv.glm</strong> function in R to calculate the cross validated estimates. Use <strong>set.seed(5410)</strong> when you calculate the cross-validated estimates</p>
<p><strong>Note</strong>: Is there an increase or decrease in MSPE with cross validation? You should be able to tell why MSPE is going up with cross-validation method.Since we assume you all know why, you are not required to enter your response in Canvas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Insert your R code for Question 3 in here</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># HINTS: </span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># You can first create a linear model with glm() function modglm=glm(logSalary ~ ., data = trainData), then call it inside the cv.glm() function</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># cv.glm(, K=5) gives  you the 5 fold-cross validation results</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># cv.glm(, K=10) gives  you the 10 fold-cross validation results</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># cv.glm(, K=n) gives  you the LOOCV results when n is the number of rows in trainData</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># cv.glm() R object stores two information under delta (cv.glm()$delta). The first information gives the  cross-validation estimate of prediction error, MSPE, that is the answer.  </span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">#set the seed</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5410</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">#creating linear model using glm and using training data</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>modglm<span class="ot">=</span><span class="fu">glm</span>(logSalary <span class="sc">~</span> ., <span class="at">data =</span> trainData)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate the mean squared prediction errors (MSPE) in the trainData based on 5-fold</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>cv5fold <span class="ot">&lt;-</span> <span class="fu">cv.glm</span>(trainData, modglm, <span class="at">K =</span> <span class="dv">5</span>)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>mspe_5fold <span class="ot">&lt;-</span> cv5fold<span class="sc">$</span>delta[<span class="dv">1</span>]</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mspe_5fold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3603185</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate the mean squared prediction errors (MSPE) in the trainData based on 10-fold</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>cv10fold <span class="ot">&lt;-</span> <span class="fu">cv.glm</span>(trainData, modglm, <span class="at">K =</span> <span class="dv">10</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>mspe_10fold <span class="ot">&lt;-</span> cv10fold<span class="sc">$</span>delta[<span class="dv">1</span>]</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mspe_10fold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3544171</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate the mean squared prediction errors (MSPE) in the trainData based on leave one out cross-validation</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>cvl <span class="ot">&lt;-</span> <span class="fu">cv.glm</span>(trainData, modglm, <span class="at">K =</span> <span class="fu">nrow</span>(trainData))</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>mspe_l <span class="ot">&lt;-</span> cvl<span class="sc">$</span>delta[<span class="dv">1</span>]</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mspe_l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3530806</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">CV5fold=</span>mspe_5fold,  <span class="at">CV10fold=</span>mspe_10fold, <span class="at">LeaveOO=</span>mspe_l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    CV5fold  CV10fold   LeaveOO
1 0.3603185 0.3544171 0.3530806</code></pre>
</div>
</div>
</section>
<section id="part-2-best-subset-model-search" class="level1">
<h1>Part 2: Best Subset Model Search</h1>
<p>You will only use <strong>trainData</strong> in Part 2.</p>
</section>
<section id="question-4" class="level1">
<h1>Question 4</h1>
<p>What is the total number of different models that can be built from all possible combinations of the predictors with p=16?</p>
<p>No coding is needed for Question 4. Just answer it in Canvas.</p>
</section>
<section id="question-5" class="level1">
<h1>Question 5</h1>
<p>Warning: This question can be challenging.</p>
<p>In this part, we will use <strong>leaps</strong> function in the <strong>leaps</strong> library in R to compare all possible models and decide on the best model by using Adjusted R-squared criteria on <strong>trainData</strong>.</p>
<p>Which set of predictors will give you the highest Adjusted R-squared value when we use the <strong><em>trainData</em></strong> to train all possible subset models. Use <strong>leaps</strong> function in the <strong>leaps</strong> library in R to compare all possible models and decide on the best model. You can use leaps package and set the <strong>nbest</strong> parameter to <strong>1</strong> to get the desired table.</p>
<p>The leaps function in R can help you to construct a table indicating the variables included in the best model of each size (p=1,p=2,…, p=16) and the corresponding Adjusted R-squared value. Hint: The table must include 16 rows, the best subset for each k. Check the lab help recordings for the details. You can use leaps package and set the nbest parameter to 1 to get the desired table. Alternatively, you can use `regsubsets` function in leaps package to get the same results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Insert your R code for Question 5 in here</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># HINTS: </span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># You can store the predictor names with  col_names = names(trainData)[-17] and insert it into leaps() function as names= col_names)</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># nbest=1 will give   you the highest performing model for each set (models with  only 1 predictor, models  with only two predictors, ,,,,, models  with only 16 predictor)</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># After creating the leaps object, you can first fet the index of best model with which () function, then print the best AdjR2 values for each set</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># In the leaps () output, the coefficient 1 in front a coefficient indicates it has been selected on that set, O means not selected</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># use all 16 subsets using regsubsets</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>leaps_md <span class="ot">&lt;-</span> <span class="fu">regsubsets</span>(logSalary <span class="sc">~</span> ., <span class="at">data =</span> trainData, <span class="at">nvmax =</span> <span class="dv">16</span>, <span class="at">nbest=</span><span class="dv">1</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the best subset model with the highest adjusted R-squared</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>best_subset <span class="ot">&lt;-</span> <span class="fu">summary</span>(leaps_md)<span class="sc">$</span>which[<span class="fu">which.max</span>(<span class="fu">summary</span>(leaps_md)<span class="sc">$</span>adjr2),]</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(best_subset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)      nAtBat       nHits       nHome       nRuns        nRBI 
       TRUE        TRUE        TRUE       FALSE       FALSE       FALSE 
        nBB     YrMajor     CrAtBat      CrHits      CrHome      CrRuns 
       TRUE        TRUE       FALSE       FALSE       FALSE        TRUE 
      CrRbi        CrBB       nOuts      nAssts      nError 
      FALSE        TRUE        TRUE       FALSE       FALSE </code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the names of the predictors in the best subset model</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>predictor_names <span class="ot">&lt;-</span><span class="fu">names</span>(trainData)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>best_predictors <span class="ot">&lt;-</span> predictor_names[best_subset[<span class="sc">-</span><span class="dv">1</span>]]</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(best_predictors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "nHits"   "nHome"   "YrMajor" "CrAtBat" "CrRbi"   "nOuts"   "nAssts" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">prednames=</span>best_predictors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  prednames
1     nHits
2     nHome
3   YrMajor
4   CrAtBat
5     CrRbi
6     nOuts
7    nAssts</code></pre>
</div>
</div>
</section>
<section id="part-3-regularized-regression" class="level1">
<h1>Part 3: Regularized Regression</h1>
<p>You will only use <strong>trainData</strong> in Part 3.</p>
</section>
<section id="question-6" class="level1">
<h1>Question 6</h1>
<p>Now, we will use the <strong>trainData</strong> and perform RIDGE regression on the full model (<strong>model_full</strong>). Before performing Ridge regression, we need to standardize the predictors but there are some packages that standardize variables for you. In that case, there is no need to standardize predictors twice. For this RLab assignment, please use <strong>glmnet</strong> package so that you do not have to worry about standardizing your features.</p>
<p>Your task is to write an R code to apply Ridge regression on <strong>trainData</strong> set with <strong>10-fold cross validation</strong>. Print the optimized lambda value and the minimum mean cross-validated Error. Keep the default loss function (t<strong>ype.measure=“mse”</strong>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Insert your R code for Question 6 in here</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># HINTS: </span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># in cv.glmnet() function choose  family='gaussian', type.measure="mse", alpha=0, nfolds=10 for the desired results</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># optimized lamba is stored under the cv.glmnet() R object</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Minimum Mean CV Error is stored under cv.glmnet() R object</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimize lambda using 10-fold cross validation</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5410</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">#make into a matrix</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> trainData<span class="sc">$</span>logSalary</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(trainData[,<span class="sc">-</span><span class="dv">17</span>])</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co">#RIDGE regression using glmnet package</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>ridge <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(x, y, <span class="at">family =</span> <span class="st">'gaussian'</span>, <span class="at">type.measure =</span> <span class="st">"mse"</span>, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">nfolds =</span> <span class="dv">10</span>)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Print the optimized lambda value</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>optlambda <span class="ot">&lt;-</span> ridge<span class="sc">$</span>lambda.min</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(optlambda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.08008381</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Print minimum mean cross-validated Error</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>minmse <span class="ot">&lt;-</span> ridge<span class="sc">$</span>cvm[<span class="fu">which.min</span>(ridge<span class="sc">$</span>cvm)]</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(minmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3358273</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">optimized_lv=</span>optlambda, <span class="at">min_mcv_Error=</span>minmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  optimized_lv min_mcv_Error
1   0.08008381     0.3358273</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="do">################practice 4 code from professor#########################</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Find the optimal lambda using 10-fold CV </span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># set alpha=0  for RIDGE</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set alpha=1  for LASSO</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co"># set alpha=0.5  for ELASTIC NET</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># predictors and the target variable</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>y.train <span class="ot">=</span> trainData<span class="sc">$</span>logSalary</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>predictors.train <span class="ot">=</span> trainData[,<span class="sc">-</span><span class="dv">17</span>]</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>y.test <span class="ot">=</span> testData<span class="sc">$</span>logSalary</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>predictors.test <span class="ot">=</span> testData[,<span class="sc">-</span><span class="dv">17</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>                           ]</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5410</span>)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimize lambda using 10-fold cross validation, keep the default lambda selection</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>RidgeCV <span class="ot">=</span> <span class="fu">cv.glmnet</span>(<span class="fu">as.matrix</span>(predictors.train), y.train,</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family=</span><span class="st">'gaussian'</span>, <span class="at">type.measure=</span><span class="st">"mse"</span>, <span class="at">alpha=</span><span class="dv">0</span>, <span class="at">nfolds=</span><span class="dv">10</span>)</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(RidgeCV)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Martinez_Yvonne_Lab4_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the values of lambda used in the fits</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>RidgeCV<span class="sc">$</span>lambda</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 551.98664459 502.94967242 458.26900971 417.55765393 380.46298279
  [6] 346.66370000 315.86705234 287.80629397 262.23837604 238.94184148
 [11] 217.71490683 198.37371456 180.75074050 164.69334288 150.06244021
 [16] 136.73130661 124.58447418 113.51673286 103.43221918  94.24358590
 [21]  85.87124548  78.24268070  71.29181659  64.95844809  59.18771860
 [26]  53.92964481  49.13868380  44.77333856  40.79579856  37.17161226
 [31]  33.86938867  30.86052553  28.11896150  25.62095046  23.34485583
 [36]  21.27096318  19.38130944  17.65952733  16.09070359  14.66124983
 [41]  13.35878480  12.17202718  11.09069783  10.10543080   9.20769218
 [46]   8.38970619   7.64438781   6.96528147   6.34650506   5.78269904
 [51]   5.26898000   4.80089834   4.37439976   3.98579014   3.63170353
 [56]   3.30907300   3.01510407   2.74725054   2.50319237   2.28081566
 [61]   2.07819428   1.89357323   1.72535340   1.57207776   1.43241871
 [66]   1.30516658   1.18921918   1.08357222   0.98731065   0.89960069
 [71]   0.81968265   0.74686430   0.68051493   0.62005986   0.56497545
 [76]   0.51478459   0.46905255   0.42738321   0.38941567   0.35482105
 [81]   0.32329973   0.29457867   0.26840911   0.24456439   0.22283796
 [86]   0.20304165   0.18500399   0.16856875   0.15359356   0.13994873
 [91]   0.12751607   0.11618790   0.10586608   0.09646123   0.08789188
 [96]   0.08008381   0.07296939   0.06648699   0.06058047   0.05519866</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the mean cross-validated error for each lambda used</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>RidgeCV<span class="sc">$</span>cvm </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 0.7679549 0.7598305 0.7576884 0.7566163 0.7554446 0.7541646 0.7527668
  [8] 0.7512412 0.7495769 0.7477623 0.7457852 0.7436324 0.7412901 0.7387436
 [15] 0.7359777 0.7329757 0.7297220 0.7261991 0.7223895 0.7182752 0.7138386
 [22] 0.7090620 0.7039282 0.6984208 0.6925244 0.6862254 0.6795120 0.6723749
 [29] 0.6648079 0.6568083 0.6483776 0.6395218 0.6302523 0.6205860 0.6105456
 [36] 0.6001602 0.5894658 0.5785037 0.5673201 0.5559687 0.5445072 0.5329969
 [43] 0.5215019 0.5100876 0.4988194 0.4877613 0.4769743 0.4665151 0.4564347
 [50] 0.4467777 0.4375807 0.4288709 0.4206707 0.4129924 0.4058403 0.3992113
 [57] 0.3930958 0.3874785 0.3823388 0.3776527 0.3733932 0.3695313 0.3660374
 [64] 0.3628815 0.3600345 0.3574683 0.3551552 0.3530691 0.3511931 0.3495030
 [71] 0.3479827 0.3466148 0.3453825 0.3442671 0.3432613 0.3423601 0.3415460
 [78] 0.3408089 0.3401454 0.3395523 0.3390156 0.3385331 0.3381031 0.3377217
 [85] 0.3373805 0.3370776 0.3368124 0.3365861 0.3363904 0.3362294 0.3360910
 [92] 0.3359878 0.3359071 0.3358496 0.3358275 0.3358273 0.3358534 0.3358974
 [99] 0.3359693 0.3360225</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the minimum mean cross-validated error </span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(RidgeCV<span class="sc">$</span>cvm) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3358273</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # number of non-zero coefficients at each lambda. For Ridge, it is all same and equal to number of predictors</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># RidgeCV$nzero</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get the value of lambda which gives you the minimum cross-validated error</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>RidgeCV<span class="sc">$</span>lambda.min</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.08008381</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the best lambda and predict the target variable in the test set, calculate MSPE</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>RidgePredictTest<span class="ot">&lt;-</span><span class="fu">predict</span>(RidgeCV,<span class="at">s=</span>RidgeCV<span class="sc">$</span>lambda.min,<span class="at">newx=</span><span class="fu">as.matrix</span>(predictors.test))</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the MSPE in the test set</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>MSPE_Ridge_test<span class="ot">&lt;-</span><span class="fu">mean</span>((RidgePredictTest<span class="sc">-</span>y.test)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">optimized_lv=</span>RidgeCV<span class="sc">$</span>lambda.min, <span class="at">min_mcv_Error=</span><span class="fu">min</span>(RidgeCV<span class="sc">$</span>cvm) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  optimized_lv min_mcv_Error
1   0.08008381     0.3358273</code></pre>
</div>
</div>
</section>
<section id="question-7" class="level1">
<h1>Question 7</h1>
<p>Now, we will use the <strong>trainData</strong> and perform <strong>LASSO</strong> regression on the full model (<strong>model_full</strong>). Please use <strong>glmnet</strong> package so that you do not have to worry about standardizing your features.</p>
<p>Your task is to write an R code to apply <strong>LASSO</strong> regression on <strong>trainData</strong> set with <strong>10-fold cross validation.</strong> Print the optimized lambda value and the minimum mean cross-validated Error. Keep the default loss function (type.measure=“mse”).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Insert your R code for Question 7 in here</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co"># HINTS: </span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co"># in cv.glmnet() function choose  family='gaussian', type.measure="mse", alpha=0, nfolds=10 for the desired results</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># optimized lamba is stored under the cv.glmnet() R object</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Minimum Mean CV Error is stored under cv.glmnet() R object</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co"># set alpha=0  for RIDGE</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># set alpha=1  for LASSO</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5410</span>)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert trainData to matrix format</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(trainData[, <span class="sc">-</span><span class="dv">17</span>])</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> trainData<span class="sc">$</span>logSalary</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform LASSO regression with 10-fold cross validation</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>lasso_fit <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X, y, <span class="at">family =</span> <span class="st">"gaussian"</span>, <span class="at">type.measure =</span> <span class="st">"mse"</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">nfolds =</span> <span class="dv">10</span>)</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the optimized lambda value and the minimum mean cross-validated error</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Optimal lambda value:"</span>, lasso_fit<span class="sc">$</span>lambda.min, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal lambda value: 0.02811896 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Minimum mean cross-validated error:"</span>, lasso_fit<span class="sc">$</span>cvm[lasso_fit<span class="sc">$</span>lambda <span class="sc">==</span> lasso_fit<span class="sc">$</span>lambda.min], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Minimum mean cross-validated error: 0.3273982 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="do">################practice 4 code from professor#########################</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Find the optimal lambda using 10-fold CV </span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># set alpha=0  for RIDGE</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set alpha=1  for LASSO</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co"># set alpha=0.5  for ELASTIC NET</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co"># predictors and the target variable</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>y.train <span class="ot">=</span> trainData<span class="sc">$</span>logSalary</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>predictors.train <span class="ot">=</span> trainData[,<span class="sc">-</span><span class="dv">17</span>]</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>y.test <span class="ot">=</span> testData<span class="sc">$</span>logSalary</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>predictors.test <span class="ot">=</span> testData[,<span class="sc">-</span><span class="dv">17</span>]</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5410</span>)</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimize lambda using 10-fold cross validation, keep the default lambda selection</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>LassoCV <span class="ot">=</span> <span class="fu">cv.glmnet</span>(<span class="fu">as.matrix</span>(predictors.train), y.train,</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family=</span><span class="st">'gaussian'</span>, <span class="at">type.measure=</span><span class="st">"mse"</span>, <span class="at">alpha=</span><span class="dv">1</span>, <span class="at">nfolds=</span><span class="dv">10</span>)</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a><span class="co"># check the values of lambda used in the fits</span></span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>LassoCV<span class="sc">$</span>lambda</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 5.519866e-01 5.029497e-01 4.582690e-01 4.175577e-01 3.804630e-01
 [6] 3.466637e-01 3.158671e-01 2.878063e-01 2.622384e-01 2.389418e-01
[11] 2.177149e-01 1.983737e-01 1.807507e-01 1.646933e-01 1.500624e-01
[16] 1.367313e-01 1.245845e-01 1.135167e-01 1.034322e-01 9.424359e-02
[21] 8.587125e-02 7.824268e-02 7.129182e-02 6.495845e-02 5.918772e-02
[26] 5.392964e-02 4.913868e-02 4.477334e-02 4.079580e-02 3.717161e-02
[31] 3.386939e-02 3.086053e-02 2.811896e-02 2.562095e-02 2.334486e-02
[36] 2.127096e-02 1.938131e-02 1.765953e-02 1.609070e-02 1.466125e-02
[41] 1.335878e-02 1.217203e-02 1.109070e-02 1.010543e-02 9.207692e-03
[46] 8.389706e-03 7.644388e-03 6.965281e-03 6.346505e-03 5.782699e-03
[51] 5.268980e-03 4.800898e-03 4.374400e-03 3.985790e-03 3.631704e-03
[56] 3.309073e-03 3.015104e-03 2.747251e-03 2.503192e-03 2.280816e-03
[61] 2.078194e-03 1.893573e-03 1.725353e-03 1.572078e-03 1.432419e-03
[66] 1.305167e-03 1.189219e-03 1.083572e-03 9.873107e-04 8.996007e-04
[71] 8.196826e-04 7.468643e-04 6.805149e-04 6.200599e-04 5.649755e-04
[76] 5.147846e-04 4.690525e-04 4.273832e-04 3.894157e-04 3.548211e-04
[81] 3.232997e-04 2.945787e-04 2.684091e-04 2.445644e-04 2.228380e-04
[86] 2.030417e-04 1.850040e-04 1.685687e-04 1.535936e-04 1.399487e-04
[91] 1.275161e-04 1.161879e-04 1.058661e-04 9.646123e-05 8.789188e-05</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the mean cross-validated error for each lambda used</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>LassoCV<span class="sc">$</span>cvm </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.7626211 0.7187932 0.6760854 0.6392750 0.5997779 0.5604548 0.5271149
 [8] 0.4992653 0.4757857 0.4561568 0.4394270 0.4245270 0.4101772 0.3974488
[15] 0.3863127 0.3761086 0.3671351 0.3597222 0.3535889 0.3485056 0.3442905
[22] 0.3407671 0.3378377 0.3354091 0.3333952 0.3317336 0.3304095 0.3293499
[29] 0.3285591 0.3279986 0.3276412 0.3274580 0.3273982 0.3274368 0.3274758
[36] 0.3275753 0.3276430 0.3277422 0.3279767 0.3284754 0.3291566 0.3297704
[43] 0.3303295 0.3304384 0.3308049 0.3314659 0.3323501 0.3332565 0.3341670
[50] 0.3350029 0.3358140 0.3363474 0.3368794 0.3374337 0.3378634 0.3382775
[57] 0.3386807 0.3389410 0.3392166 0.3395085 0.3398727 0.3402306 0.3405162
[64] 0.3407739 0.3410502 0.3412376 0.3415589 0.3418119 0.3421818 0.3426265
[71] 0.3431192 0.3436312 0.3441581 0.3446797 0.3452148 0.3456916 0.3460967
[78] 0.3464822 0.3467951 0.3470576 0.3473081 0.3476005 0.3478981 0.3481523
[85] 0.3483630 0.3485405 0.3487013 0.3488507 0.3489915 0.3491191 0.3492364
[92] 0.3493366 0.3494263 0.3495150 0.3495930</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the minimum mean cross-validated error </span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(LassoCV<span class="sc">$</span>cvm) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3273982</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># optimal lambda</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>LassoCV<span class="sc">$</span>lambda.min</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02811896</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of non-zero coefficients at each lambda. </span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>LassoCV<span class="sc">$</span>nzero</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> s0  s1  s2  s3  s4  s5  s6  s7  s8  s9 s10 s11 s12 s13 s14 s15 s16 s17 s18 s19 
  0   1   2   2   3   3   3   4   4   4   4   5   5   5   6   7   7   7   7   7 
s20 s21 s22 s23 s24 s25 s26 s27 s28 s29 s30 s31 s32 s33 s34 s35 s36 s37 s38 s39 
  7   7   7   7   7   7   7   7   7   7   7   7   7   7   8   9   9   9   9   9 
s40 s41 s42 s43 s44 s45 s46 s47 s48 s49 s50 s51 s52 s53 s54 s55 s56 s57 s58 s59 
 10  10  10  10  10   9  10  11  11  12  12  12  12  13  13  13  13  13  13  13 
s60 s61 s62 s63 s64 s65 s66 s67 s68 s69 s70 s71 s72 s73 s74 s75 s76 s77 s78 s79 
 14  14  15  15  15  14  14  14  14  14  14  14  14  15  15  15  15  15  15  15 
s80 s81 s82 s83 s84 s85 s86 s87 s88 s89 s90 s91 s92 s93 s94 
 16  16  16  16  16  16  16  16  16  16  16  16  16  15  15 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># numnber of features at the optimal lambda</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>LassoCV<span class="sc">$</span>nzero[LassoCV<span class="sc">$</span>lambda <span class="sc">==</span> LassoCV<span class="sc">$</span>lambda.min]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>s32 
  7 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the best lambda and predict the target variable in the test set with Lasso and  calculate MSPE</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>LassoPredictTest<span class="ot">&lt;-</span><span class="fu">predict</span>(LassoCV,<span class="at">s=</span>LassoCV<span class="sc">$</span>lambda.min,<span class="at">newx=</span><span class="fu">as.matrix</span>(predictors.test))</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>MSPE_Lasso_test<span class="ot">&lt;-</span><span class="fu">mean</span>((LassoPredictTest<span class="sc">-</span>y.test)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">optimized_lv=</span>LassoCV<span class="sc">$</span>lambda.min, <span class="at">min_mcv_Error=</span><span class="fu">min</span>(LassoCV<span class="sc">$</span>cvm) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  optimized_lv min_mcv_Error
1   0.02811896     0.3273982</code></pre>
</div>
</div>
</section>
<section id="question-8" class="level1">
<h1>Question 8</h1>
<p>Which variables were selected based on LASSO?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Insert your R code for Question 7 in here</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co"># HINTS: use coef() to extract the coefficients. Any coefficient with 0 estimate is dropped from the regression</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>lasso_coef <span class="ot">&lt;-</span> <span class="fu">coef</span>(LassoCV, <span class="at">s =</span> LassoCV<span class="sc">$</span>lambda.min)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>selected_vars <span class="ot">&lt;-</span> <span class="fu">rownames</span>(lasso_coef)[lasso_coef[,<span class="dv">1</span>] <span class="sc">!=</span> <span class="dv">0</span>]</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(selected_vars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "(Intercept)" "nHits"       "nRBI"        "nBB"         "YrMajor"    
[6] "CrHits"      "CrRbi"       "nOuts"      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Insert your R code for Question 7 in here</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co"># HINTS: use coef() to extract the coefficients. Any coefficient with 0 estimate is dropped from the regression</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Lasso model</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Lasso model</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Lasso model</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>LassoCV <span class="ot">=</span> <span class="fu">cv.glmnet</span>(<span class="fu">as.matrix</span>(predictors.train), y.train,</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family=</span><span class="st">'gaussian'</span>, <span class="at">type.measure=</span><span class="st">"mse"</span>, <span class="at">alpha=</span><span class="dv">1</span>, <span class="at">nfolds=</span><span class="dv">10</span>)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Get coefficients for optimal lambda</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>opt_lambda <span class="ot">=</span> LassoCV<span class="sc">$</span>lambda.min</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>coef_LassoCV <span class="ot">=</span> <span class="fu">coef</span>(LassoCV, <span class="at">s=</span>opt_lambda)</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(coef_LassoCV)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>17 x 1 sparse Matrix of class "dgCMatrix"
                       s1
(Intercept)  4.226378e+00
nAtBat       .           
nHits        6.229214e-03
nHome        3.335577e-04
nRuns        .           
nRBI         9.501867e-04
nBB          5.541235e-03
YrMajor      6.741847e-02
CrAtBat      .           
CrHits       1.685110e-04
CrHome       .           
CrRuns       .           
CrRbi        2.575131e-05
CrBB         .           
nOuts        3.876770e-04
nAssts       .           
nError      -1.743525e-04</code></pre>
</div>
</div>
</section>
<section id="part-4" class="level1">
<h1>PART 4</h1>
<p>You will only use <strong>testData</strong> in Part 4.</p>
<p>Now, it is time to put all the fitted models a test. Predict <strong>logSalary</strong> for each of the rows in the test data, <strong>testData</strong>, using model_full in Part 1, best subset model in Part 2, and Ridge and Lasso Regression models in Part 3.</p>
<p>Calculate the MSPE on the test set for each model and insert your answer in Canvas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Insert your R code for Question 7 in here</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>OLSmodel<span class="ot">&lt;-</span><span class="fu">lm</span>(logSalary<span class="sc">~</span>.,<span class="at">data=</span>testData)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>OLSPredictTest<span class="ot">&lt;-</span><span class="fu">predict</span>(OLSmodel,<span class="at">newx=</span><span class="fu">as.matrix</span>(predictors.test))</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>MSPE_OLS_test<span class="ot">&lt;-</span><span class="fu">mean</span>((OLSPredictTest<span class="sc">-</span>y.test)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="co"># performance comparison</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="co"># OLS</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>MSPE_OLS_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2048143</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>MSPE_Ridge_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4300489</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Lasso</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>MSPE_Lasso_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4287379</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">MSPE_OLS_test=</span>MSPE_OLS_test, <span class="at">MSPE_Ridge_test=</span>MSPE_Ridge_test,<span class="at">MSPE_Lasso_test=</span>MSPE_Lasso_test )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  MSPE_OLS_test MSPE_Ridge_test MSPE_Lasso_test
1     0.2048143       0.4300489       0.4287379</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>